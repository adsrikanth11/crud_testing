# Authentication System Visual Guide

## ğŸ“‹ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENT APPLICATION                      â”‚
â”‚  (Browser / Mobile App / Desktop Client)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP Request
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EXPRESS SERVER                             â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Middleware Chain                                      â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚   â”‚
â”‚  â”‚ â”‚ Cookie Parser   â”‚ â—„â”€â”€ Extract token from request   â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚   â”‚
â”‚  â”‚          â”‚                                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚
â”‚  â”‚ â”‚ Auth Middleware  â”‚ â—„â”€â”€ Verify JWT signature        â”‚   â”‚
â”‚  â”‚ â”‚ (authenticate)   â”‚                                 â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚
â”‚  â”‚          â”‚                                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚   â”‚
â”‚  â”‚ â”‚ Authz Middleware  â”‚ â—„â”€â”€ Check user role            â”‚   â”‚
â”‚  â”‚ â”‚ (authorize)       â”‚                                â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Route Handlers / Controllers                          â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚ â”‚ Auth Routes                                   â”‚    â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ POST /api/auth/register â”€â–º Create User    â”‚    â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ POST /api/auth/login â”€â”€â”€â–º Generate JWT    â”‚    â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ GET  /api/auth/me â”€â”€â”€â”€â”€â”€â–º Retrieve User   â”‚    â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ POST /api/auth/logout â”€â”€â–º Clear Cookie    â”‚    â”‚   â”‚
â”‚  â”‚ â”‚ â€¢ POST /api/auth/refresh â”€â–º New Token       â”‚    â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Database Query
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MySQL DATABASE                            â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ users table                                           â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ id (INT)       â”‚ Primary Key                       â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ username       â”‚ UNIQUE NOT NULL                   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ email          â”‚ UNIQUE NOT NULL                   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ password       â”‚ NOT NULL (hashed)                â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ role           â”‚ ENUM('user', 'admin')            â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ is_active      â”‚ BOOLEAN DEFAULT TRUE              â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ created_at     â”‚ TIMESTAMP                         â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ updated_at     â”‚ TIMESTAMP                         â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REGISTRATION FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input                App Action                  Server Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ username     â”‚                                     â”‚              â”‚
â”‚ email        â”‚â”€â”€â”                                  â”‚              â”‚
â”‚ password     â”‚  â”‚                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚              â”‚
                  â”‚ POST /api/auth/register          â”‚              â”‚
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
                  â”‚                                  â”‚ Validate     â”‚
                  â”‚                                  â”‚ Email format â”‚
                  â”‚                                  â”‚ Password len â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Hash passwordâ”‚
                  â”‚                                  â”‚ (bcryptjs)   â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Create user  â”‚
                  â”‚                                  â”‚ in database  â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Generate JWT â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Set cookie   â”‚
                  â”‚ 201 Created + JWT Token          â”‚              â”‚
                  â”‚ HttpOnly, SameSite=Strict        â”‚              â”‚
                  â”‚                                  â”‚              â”‚
User receives Token & Cookie
(stored automatically)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOGIN FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input                App Action                  Server Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ username     â”‚                                     â”‚              â”‚
â”‚ password     â”‚â”€â”€â”                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚              â”‚
                  â”‚ POST /api/auth/login             â”‚              â”‚
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
                  â”‚                                  â”‚ Find user    â”‚
                  â”‚                                  â”‚ by username  â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Verify pwd   â”‚
                  â”‚                                  â”‚ (bcrypt)     â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Check active â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Generate JWT â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Set cookie   â”‚
                  â”‚ 200 OK + User Info + JWT Token   â”‚              â”‚
                  â”‚ HttpOnly, SameSite=Strict        â”‚              â”‚
                  â”‚                                  â”‚              â”‚
User receives Token & Cookie
(stored automatically)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROTECTED ROUTE ACCESS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client Request                Middleware Chain        Server Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Include      â”‚                                     â”‚              â”‚
â”‚ Cookie:      â”‚                                     â”‚              â”‚
â”‚ token=<JWT>  â”‚â”€â”€â”                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚              â”‚
                  â”‚ GET /api/protected               â”‚              â”‚
                  â”‚ Cookies: token=<JWT>             â”‚              â”‚
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
                  â”‚                                  â”‚ Parse cookie â”‚
                  â”‚                                  â”‚ Extract tokenâ”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Verify JWT   â”‚
                  â”‚                                  â”‚ signature    â”‚
                  â”‚                                  â”‚ Check expiry â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Extract user â”‚
                  â”‚                                  â”‚ data from    â”‚
                  â”‚                                  â”‚ token        â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Check role   â”‚
                  â”‚                                  â”‚ (if required)â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Execute      â”‚
                  â”‚                                  â”‚ handler      â”‚
                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
                  â”‚ 200 OK + Protected Resource      â”‚              â”‚
                  â”‚                                  â”‚              â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LOGOUT FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client Request                Server Action           Server Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Include      â”‚                                     â”‚              â”‚
â”‚ Cookie:      â”‚                                     â”‚              â”‚
â”‚ token=<JWT>  â”‚â”€â”€â”                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚              â”‚
                  â”‚ POST /api/auth/logout            â”‚              â”‚
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚
                  â”‚                                  â”‚ Verify token â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚                                  â”‚ Clear cookie â”‚
                  â”‚                                  â”‚ (Max-Age=0)  â”‚
                  â”‚                                  â”‚              â”‚
                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚              â”‚
                  â”‚ 200 OK + "Logout successful"     â”‚              â”‚
                  â”‚ Set-Cookie: token=; Max-Age=0    â”‚              â”‚
                  â”‚                                  â”‚              â”‚
Token cleared from client storage
```

## ğŸ—ï¸ System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Application                          â”‚
â”‚  app.js                                                      â”‚
â”‚  â”œâ”€â”€ Express initialization                                 â”‚
â”‚  â”œâ”€â”€ Middleware setup                                       â”‚
â”‚  â”œâ”€â”€ Route registration                                     â”‚
â”‚  â””â”€â”€ Error handling                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                â”‚
       â–¼                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controllers               â”‚      â”‚  Routes                â”‚
â”‚  (Business Logic)           â”‚      â”‚  (Endpoint Mapping)    â”‚
â”‚                             â”‚      â”‚                        â”‚
â”‚  AuthController             â”‚      â”‚  auth.routes.js        â”‚
â”‚  â”œâ”€â”€ register()             â”‚      â”‚  â”œâ”€â”€ POST /register    â”‚
â”‚  â”œâ”€â”€ login()                â”‚      â”‚  â”œâ”€â”€ POST /login       â”‚
â”‚  â”œâ”€â”€ logout()               â”‚      â”‚  â”œâ”€â”€ POST /logout      â”‚
â”‚  â”œâ”€â”€ getCurrentUser()       â”‚      â”‚  â”œâ”€â”€ GET /me           â”‚
â”‚  â””â”€â”€ refreshToken()         â”‚      â”‚  â””â”€â”€ POST /refresh     â”‚
â”‚                             â”‚      â”‚                        â”‚
â”‚  ProductController          â”‚      â”‚  product.routes.js     â”‚
â”‚  â””â”€â”€ ... existing ...       â”‚      â”‚  â””â”€â”€ ... existing ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
           â”‚         â”‚                      â”‚ â”‚
           â–¼         â–¼                      â–¼ â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           Models (Data Access)              â”‚
         â”‚                                              â”‚
         â”‚  User Model                                  â”‚
         â”‚  â”œâ”€â”€ create()       â”€â”                       â”‚
         â”‚  â”œâ”€â”€ findById()      â”‚                       â”‚
         â”‚  â”œâ”€â”€ findByUsername()â”œâ”€â–º Database Query      â”‚
         â”‚  â”œâ”€â”€ update()        â”‚                       â”‚
         â”‚  â”œâ”€â”€ delete()       â”€â”˜                       â”‚
         â”‚  â””â”€â”€ ... more ...                            â”‚
         â”‚                                              â”‚
         â”‚  Product Model                               â”‚
         â”‚  â””â”€â”€ ... existing ...                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚
        â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Middleware        â”‚  â”‚  Database        â”‚
    â”‚                    â”‚  â”‚                  â”‚
    â”‚  authMiddleware.js â”‚  â”‚  MySQL           â”‚
    â”‚  â”œâ”€â”€ authenticate()â”‚  â”‚  â”‚ users table   â”‚
    â”‚  â””â”€â”€ authorize()   â”‚  â”‚  â”‚ products tbl  â”‚
    â”‚                    â”‚  â”‚  â””â”€â”€ indexes     â”‚
    â”‚  errorHandler.js   â”‚  â”‚                  â”‚
    â”‚  notFoundHandler   â”‚  â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Layers

```
Request Lifecycle Security:

1. COOKIE SECURITY
   â”œâ”€â”€ HttpOnly Flag
   â”‚   â””â”€ Prevents JavaScript access (XSS protection)
   â”œâ”€â”€ SameSite=Strict
   â”‚   â””â”€ Prevents CSRF attacks
   â””â”€â”€ Secure Flag
       â””â”€ HTTPS only in production

2. TOKEN SECURITY
   â”œâ”€â”€ JWT Signature
   â”‚   â””â”€ Signed with secret key
   â”œâ”€â”€ Token Expiration
   â”‚   â””â”€ Configurable (default 7 days)
   â””â”€â”€ Token Validation
       â””â”€ Checked on every request

3. PASSWORD SECURITY
   â”œâ”€â”€ Bcryptjs Hashing
   â”‚   â””â”€ 10 salt rounds
   â”œâ”€â”€ Minimum Length
   â”‚   â””â”€ 6 characters required
   â””â”€â”€ Never Exposed
       â””â”€ Not returned in API responses

4. DATABASE SECURITY
   â”œâ”€â”€ Input Validation
   â”‚   â”œâ”€ Email format
   â”‚   â””â”€ Password strength
   â”œâ”€â”€ SQL Injection Prevention
   â”‚   â””â”€ Prepared statements
   â””â”€â”€ Unique Constraints
       â”œâ”€ Username unique
       â””â”€ Email unique

5. AUTHORIZATION SECURITY
   â”œâ”€â”€ Role-Based Access
   â”‚   â”œâ”€ User role
   â”‚   â””â”€ Admin role
   â””â”€â”€ Request Validation
       â””â”€ Headers, body, params
```

## ğŸ“Š Database Schema Diagram

```
users TABLE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column          â”‚ Type        â”‚ Constraint      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚ INT         â”‚ PK, AUTO_INC    â”‚
â”‚ username        â”‚ VARCHAR(255)â”‚ UNIQUE, NOT NULLâ”‚
â”‚ email           â”‚ VARCHAR(255)â”‚ UNIQUE, NOT NULLâ”‚
â”‚ password        â”‚ VARCHAR(255)â”‚ NOT NULL        â”‚
â”‚ role            â”‚ ENUM        â”‚ DEFAULT 'user'  â”‚
â”‚ is_active       â”‚ BOOLEAN     â”‚ DEFAULT TRUE    â”‚
â”‚ created_at      â”‚ TIMESTAMP   â”‚ DEFAULT NOW()   â”‚
â”‚ updated_at      â”‚ TIMESTAMP   â”‚ DEFAULT NOW()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INDEXES:
  â€¢ PRIMARY KEY (id)
  â€¢ UNIQUE INDEX (username)
  â€¢ UNIQUE INDEX (email)
  â€¢ INDEX (role)
  â€¢ INDEX (is_active)
```

## ğŸ§ª Test Coverage Map

```
Authentication System Tests:

Unit Tests (60+ cases)
â”œâ”€â”€ User Model (45+ cases)
â”‚   â”œâ”€â”€ Creation Tests (8 cases)
â”‚   â”œâ”€â”€ Query Tests (3 cases)
â”‚   â”œâ”€â”€ Update Tests (2 cases)
â”‚   â”œâ”€â”€ Password Tests (2 cases)
â”‚   â”œâ”€â”€ Delete Tests (2 cases)
â”‚   â”œâ”€â”€ Activation Tests (2 cases)
â”‚   â””â”€â”€ Validation Tests (2 cases)
â”‚
â””â”€â”€ Auth Middleware (15+ cases)
    â”œâ”€â”€ Token Verification (4 cases)
    â”œâ”€â”€ Authorization (4 cases)
    â””â”€â”€ Optional Auth (4 cases)

Integration Tests (30+ cases)
â”œâ”€â”€ Registration (6 cases)
â”œâ”€â”€ Login (5 cases)
â”œâ”€â”€ Logout (3 cases)
â”œâ”€â”€ Get User (3 cases)
â”œâ”€â”€ Token Refresh (2 cases)
â”œâ”€â”€ Protected Routes (3 cases)
â””â”€â”€ Complete Flow (3 cases)

Test Helpers
â”œâ”€â”€ User creation utilities
â”œâ”€â”€ Token extraction utilities
â”œâ”€â”€ Request makers
â””â”€â”€ Error validators
```

## ğŸ“ˆ Middleware Execution Flow

```
â”Œâ”€ Incoming Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                  â”‚
â”‚  GET /api/products with token=<JWT>             â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ cookieParser()           â”‚
         â”‚ Extract: token=<JWT>     â”‚
         â”‚ Store in: req.cookies    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ authenticate             â”‚
         â”‚ Verify: JWT signature    â”‚
         â”‚ Check: Token expiry      â”‚
         â”‚ Store in: req.user       â”‚
         â”‚ {id, username, role...}  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                  â”‚           â”‚
            [Success]    [Error: 401]
                  â”‚           â”‚
                  â–¼           â””â”€â”€â”€â–º 401 Response
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ authorize(['admin'])     â”‚
         â”‚ Check: req.user.role     â”‚
         â”‚ Verify: role in allowed  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                  â”‚           â”‚
            [Success]    [Error: 403]
                  â”‚           â”‚
                  â–¼           â””â”€â”€â”€â–º 403 Response
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Route Handler            â”‚
         â”‚ Execute: Business logic  â”‚
         â”‚ Access: req.user info    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Response                 â”‚
         â”‚ Status: 200 OK           â”‚
         â”‚ Body: Resource data      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Token Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          TOKEN LIFECYCLE (7 days default)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GENERATION (Login/Register)
       â”‚
       â–¼
    Created
       â”‚
       â”œâ”€ Valid for 7 days
       â”‚
       â”œâ”€ Used in every request
       â”‚
       â”œâ”€ Checked by middleware
       â”‚
       â”œâ”€ Claim check
       â”‚  â”œâ”€ Signature valid
       â”‚  â””â”€ Not expired
       â”‚
       â–¼
   Day 5 (User wants to extend)
       â”‚
       â”œâ”€ Optional: Refresh token
       â”‚  â””â”€ New token generated
       â”‚  â””â”€ Cookie updated
       â”‚
       â–¼
   Day 7 (Expiration time)
       â”‚
       â”œâ”€ Token becomes invalid
       â”‚
       â”œâ”€ Middleware returns 401
       â”‚
       â”œâ”€ User must refresh or login
       â”‚
       â–¼
   LOGOUT (Any time)
       â”‚
       â”œâ”€ Cookie cleared
       â”‚
       â”œâ”€ Token discarded
       â”‚
       â””â”€ Session ends
```

## ğŸ¯ Request Authorization Decision Tree

```
             Request Received
                    â”‚
                    â–¼
         â”Œâ”€ Is token in cookie? â”€â”
         â”‚                        â”‚
        YES                       NO
         â”‚                        â”‚
         â–¼                        â–¼
    Verify Token         â”Œâ”€ Is auth required? â”€â”
    Signature                              â”‚
         â”‚                                YES        NO
         â”œâ”€ Valid                          â”‚          â”‚
         â”‚  â””â”€â–º Continue                   â”‚          â–¼
         â”‚                                 â–¼      Allow Access
         â”œâ”€ Expired                   Return 401    (Public)
         â”‚  â””â”€â–º Return 401                 â”‚
         â”‚                                 â”‚
         â””â”€ Invalid                        â”‚
            â””â”€â–º Return 401     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        Extract user from token
                                â”‚
                                â–¼
                        â”Œâ”€ Is role required? â”€â”
                        â”‚                      â”‚
                       YES                    NO
                        â”‚                      â”‚
                        â–¼                      â–¼
                Check user.role    â”Œâ”€ Execute Handler â”€â”
                  in allowed                          â”‚
                        â”‚                             â”‚
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                        â”‚
                   â”‚          â”‚                       â”‚
               Allowed    Not Allowed                 â”‚
                   â”‚          â”‚                       â”‚
                   â”‚      Return 403                  â”‚
                   â”‚                                  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        Return Response
                        (200, 201, 404, etc)
```

---

This visual guide helps understand how the authentication system works at a glance. Refer to the text documentation for detailed implementation.
